---
title: "R Notebook"
output: html_notebook
---

I will be analysing a Heart Disease dataset.

The data contains 296 observations. The columns are as described below:

* age;
* sex:
  * 0 -> female
  * 1 -> male
* cp - Chest pain type:
  * 0 -> asymptomatic
  * 1 -> angina (chest pain due to not enough blood flow to the heart muscle)
  * 2 -> pain without relation to angina
  * 3 -> typical angina
* trestbps - Resting blood pressure in millimeters of mercury (mm Hg);
* chol - Cholesterol level in mg/dl;
* fbs - level of sugar in the blood is higher than 120 mg/dl or not:
  * 0 -> no
  * 1 -> yes
* restecg - Results of the electrocardiogram on rest:
  * 0: probable left ventricular hypertrophy
  * 1: normal
  * 2: abnormalities in the T wave or ST segment
* thalach - Maxium heart rate during the stress test;
* exang - If patient had angina (chest pain) during exercise:
  * 0 -> no
  * 1 -> yes
* oldpeak - Decrease of the ST segment during exercise according to the same one on rest;
* slope - Slope of the ST segment during the most demanding part of the exercise:
  * 0 -> descending
  * 1 -> flat
  * 2 -> ascending
* ca - Number of main blood vessels that are narrow, coloured by the radioactive dye;
* thal - Results of the blood flow observed via the radioactive dye;
  * 1 -> fixed defect (no blood flow in some part of the heart)
  * 2 -> normal blood flow
  * 3 -> reversible defect (a blood flow is observed but it is not normal)
* target - If patient has heart disease:
  * 0 -> yes
  * 1 -> no

```{r}
# Read the dataset into variable
df = read.csv('heart.csv')
```
\

## Question 1

### a) Describe the dataset using appropriate plots/curves/charts

```{r}
target_tb = table(df$target)
barp <- barplot(
  target_tb,
  col = c("#2CA02C", "#D62728"),
  xlab = "Disease in patient",
  ylab = "Number of Patients",
  names.arg = c("no", "yes"),
  ylim = c(0, 180)
)
text(barp, target_tb + 10,target_tb,cex=0.8)
hist(
  df$age,
  main = "Age Distribution",
  xlab = "Age",
  ylab = "Number of Patients",
  col = "grey"
)
boxplot(
  df$trestbps,
  main = "Resting blood pressure in millimeters of mercury (mm Hg)",
  horizontal = TRUE
)
plot(
  main = "Resting blood pressure",
  x = df$age,
  xlab = "Age",
  y = df$trestbps,
  ylab = "BP (mm Hg)"
)
#add linear trend
abline(lm(df$trestbps ~ df$age)) 

boxplot(
  df$chol,
  main = "Cholesterol level in mg/dl",
  horizontal = TRUE
)
plot(
  main = "Cholesterol level",
  x = df$age,
  xlab = "Age",
  y = df$chol,
  ylab = "Cholesterol level (mg/dl)",
  ylim = c(0, 600)
)
#add linear trend
abline(lm(df$chol ~ df$age)) 
```

As shown in the graphs above, the dataset contains a balanced number of observations between patients with and without heart disease. These patients' age are mainly between 40 and 70 years old, which is the typical age that heart disease starts to show(1).

\  

### b) Consider one of continuous attributes, and compute central and variational measures

Continuous Attribute chosen: 
**"Resting blood pressure in millimeters of mercury (mm Hg)"** \
\

```{r}
# Declaring all measures
att = df$trestbps
att_mean = mean(att)
att_median = median(att)
att_sd = sd(att)
att_max = max(att)
att_min = min(att)
att_range = att_max - att_min
```

```{r}
paste0("Mean: ", format(att_mean, digits = 3, nsmall = 2))
```
```{r}
paste0("Median: ", att_median)
```

With the `mean > median`, we can say that the data has a rightward skewness. That is confirmed by the graphs below:

``` {r}
hist(
  att,
  main = "Resting Blood Pressure Distribution",
  xlab = "BP (mm Hg)",
  ylab = "Number of Patients",
  col = "grey"
)
plot(
  density(att),
  main = "Blood Pressure Density",
)
```

```{r}
paste0(
  "Average ",
  format(att_mean, digits = 3, nsmall = 2),
  " +- SD ",
  format(att_sd, digits = 3, nsmall = 2), sep=""
)
```
```{r}
paste0("Max Value: ", att_max, " - Min Value: ", att_min, " - Range: ", att_range)
```

### c) Chebyshev's rule with one-sigma interval. Specify the outliers if any

```{r}
lower_bound = att_mean - att_sd
upper_bound = att_mean + att_sd
interval = c(lower_bound, upper_bound)
print(paste0(
  "One sigma interval: from ",
  format(lower_bound, digits = 3, nsmall = 2),
  " to ",
  format(upper_bound, digits = 3, nsmall = 2)
))

outliers = c()

for(i in 1:length(att)){
  if(att[i] < lower_bound | att[i] > upper_bound){
    val = att[i]
  }else{
    val = NULL
  }
  outliers = c(outliers, val)
}

hist(
  outliers,
  main = "Blood Pressure Distribution",
  xlab = "BP (mm Hg)",
  ylab = "Number of Patients",
  col = "grey"
)
table(outliers)
print(paste0("As shown above, we have ", length(outliers), " outliers."))
```

### d) Box-plot technique to detect outliers.
```{r}
boxplot(
  att,
  main = "Resting blood pressure in millimeters of mercury (mm Hg)",
  horizontal = TRUE
)
```
I applied the boxplot to the Resting Blood Pressure column. This type of graph has 4 main components:
1) Median, which is the central value;
2) The "box" range, which represents 25th and 75 Percentile;
3) the min value, which is the (25th Percentile - "box" range * 1.5)
4) the max value, which is the (75th Percentile + "box" range * 1.5)

The min and max values represent a ~2.7 sigma internal, which represents 99.3% of the dataset. Outside that range would be only 0.7% of the values, or the outliers.

As seen above, we can determine that only a handful of values are outside the interval mentioned above, with one even being at the 200 mark, which is almost 4 sigma.

\  

## Question 2

### a) Select four variables of the dataset, and propose an appropriate probability model to quantify uncertainty of each variable.

For this exercise, I will be using the following variables:

**Sex**: 
This is a categorical variable with only 2 possible outcomes, 0-female or 1-male. In this case, I suggest using the Binomial Distribution to quantify the uncertainty

**Chest pain type**:
This is a categorical variable with 4 possible outcomes, as mentioned in the first section. For this variable, we need to use Multinomial Distribution

**Resting blood pressure in millimeters of mercury (mm Hg)**:
This is a continuous variable, mesuring the blood pressure of patients. FINISH THIS

**Cholesterol level in mg/dl**:


### b) Parameter Estimation

##### Sex

```{r}
# choose variable
var1 = df$sex  # binomial
# frequency table
tab_1 = table(var1)
# parameter
p_hat1 = tab_1[2] / sum(tab_1)
print(paste0("Since the variables are only 0 and 1, the parameter for this model is ",
             "the chance of getting 1. In this case ", format(p_hat1, digits = 3, nsmall = 2)))
```

---

##### Chest pain type
```{r}
# choose variable
var2 = df$cp  # multinomial
# frequency
tab2 = table(var2)
# relative frequency - parameters
phat2 = tab2 / sum(tab2)
print("The parameters for this model are:")
phat2
```
For a multinomial distribution, we need to calculate the relative frequency of each variable value. That percentage will be the probability of that variable be assigned to that value.

---

##### Resting blood pressure

For the next 2 variables, I'll be using the Normal Model.
The parameters we use for Normal Model are mean and standard deviation.
```{r}
var3 = df$trestbps  # continuous
var3_mean = mean(var3)
var3_sigma = sd(var3)
```

##### Cholesterol
```{r}
var4 = df$chol  # continuous
var4_mean = mean(var4)
var4_sigma = sd(var4)
```


### c) Express the way in which each model can be used for the predictive analytics, then find the prediction for each attribute.

##### Sex

```{r}
# generate 1000 random samples
random_set_1 = rbinom(n = 1000, size = 1, prob = p_hat1)
print(paste0(
  "When summing the sample generated by the binomial distribution, we get ",
  sum(random_set_1),
  ". That means that 1 was predicted that amount of times, so it is our prediction."
))
```

---

```{r}
# generate 1000 random samples
sample2 = rmultinom(n = 1000, size = 1, prob = p_hat2)
# count each category
n0 = sum(sample2[1,])
n1 = sum(sample2[2,])
n2 = sum(sample2[3,])
n3 = sum(sample2[4,])
```
There are 4 possible outcomes for 'chest pain type' variable. In the sample generated by the multinomial distribution, this is the number of times each variable was predicted, from 0 to 3:
```{r}
print(paste0("0: ", n0))
print(paste0("1: ", n1))
print(paste0("2: ", n2))
print(paste0("3: ", n3))
```
According to the sample generated using multinomial model, the predicted value is Category 0 - asymptomatic.

---

##### Resting blood pressure
```{r}
# generate 1000 random samples
sample3 = rnorm(n = 1000,mean = var4_mean, sd = var4_sigma)
prediction_3 = mean(sample3)
prediction_3
```


##### Cholesterol
```{r}
# generate 1000 random samples
sample4 = rnorm(n = 1000,mean = var4_mean, sd = var4_sigma)
prediction_4 = mean(sample4)
prediction_4
```


Both examples above, I used the Normal Model. The predicted value can be found by taking the mean of the generated sample.


## Question 3

From your dataset, specify your input and output variables, then:

### a) Suggest an appropriate GLM to model ouput to input variables.

For this dataset, we want to know if the person is likely or not to have a heart condition. This means that there are 2 options for the output variable, 0 -> yes and 1 -> no. For a binary output, we will use Binomial

### b) Split the dataset into 80% as a trainset and 20% testset, then model the trainset by fitting your proposed GLM.
```{r}
library(caTools)
split = sample.split(df, SplitRatio=.8)

# training dataset
trainset = subset(df, split==T)
# test dataset
testset = subset(df, split==F)

dim(testset)
dim(trainset)

trainset.glm = glm( target ~ sex+cp+trestbps+chol+fbs+restecg+thalach+exang+oldpeak+slope+ca+thal, trainset, family="binomial") # ~. shows that we include all ind. variables
summary(trainset.glm) # both variable are sig.
```
### c) Specify the significant variables on the output variable at the level of ùõº=0.05 and explore the related hypotheses test. Estimate the parameters of your model.

After testing all columns, I can now select the ones that have a high correlation in predicting a heart condition, where alpha <= 0.05:

* sex;
* cp (chest pain);
* thalach (Maxium heart rate during the stress test)
* exang (If patient had angina (chest pain) during exercise)
* slope (Slope of the ST segment during the most demanding part of the exercise)
* ca (Number of main blood vessels that are narrow, coloured by the radioactive dye)
* thal (Results of the blood flow observed via the radioactive dye)

### d)Predict the output of the test dataset using the trained model. And provide the functional form of the optimal predictive model.
### e) Propose the appropriate measure of performance to evaluate the model and compute it for your derived model.



\  


(1): Institute of Medicine (US) Committee on Preventing the Global Epidemic of Cardiovascular Disease: Meeting the Challenges in Developing Countries; Fuster V, Kelly BB, editors. Promoting Cardiovascular Health in the Developing World: A Critical Challenge to Achieve Global Health. Washington (DC): National Academies Press (US); 2010. 2, Epidemiology of Cardiovascular Disease. Available from: https://www.ncbi.nlm.nih.gov/books/NBK45688/